@startuml

entity "User" as user {
  *user_id : int <<PK>>
  --
  username : varchar
  password : varchar
  email : varchar
  profile_picture : varchar
}

entity "Admin" as admin {
  *admin_id : int <<PK>>
  --
  username : varchar
  password : varchar
}

entity "Transaction" as transaction {
  *transaction_id : int <<PK>>
  user_id : int <<FK>>
  --
  total_amount : decimal
  total_quantity : int
  status : varchar
  created_at : datetime
  updated_at : datetime
}

entity "Transaction_Detail" as transaction_detail {
  *detail_id : int <<PK>>
  transaction_id : int <<FK>>
  version_id : int <<FK>>
  --
  quantity : int
  total : decimal
}

entity "Admin_Log" as admin_log {
  *log_id : int <<PK>>
  admin_id : int <<FK>>
  --
  action : varchar
  timestamp : datetime
}

entity "Product" as product {
  *product_id : int <<PK>>
  --
  product_name : varchar
  brand_id : int <<FK>>
  category_id : int <<FK>>
}

entity "Product_Version" as product_version {
  *version_id : int <<PK>>
  product_id : int <<FK>>
  previous_version_id : int <<FK, nullable>>
  --
  size : varchar
  color : varchar
  description : text
  price : decimal
  stock : int
  active_from : datetime
  active_to : datetime <<nullable>>
}

entity "Category" as category {
  *category_id : int <<PK>>
  --
  category_name : varchar
}

entity "Brand" as brand {
  *brand_id : int <<PK>>
  --
  brand_name : varchar
}

entity "Address" as address {
  *address_id : int <<PK>>
  user_id : int <<FK>>
  --
  full_address : text
  sub_district : int
  district : int
  city : int
  province : int
  postal_code : varchar
}

entity "Cart" as cart {
  *cart_id : int <<PK>>
  user_id : int <<FK>>
  created_at : datetime
}

entity "Cart_Detail" as cart_detail {
  *cart_id : int <<FK>>
  *version_id : int <<FK>>
  quantity : int
}

entity "Wishlist" as wishlist {
  *wishlist_id : int <<PK>>
  user_id : int <<FK>>
  version_id : int <<FK>>
  created_at : datetime
}

' =========================
' Relationships
' =========================
user ||--o{ address             : has
product }o--|| category
product }o--|| brand
admin_log }o--|| admin
cart }o--|| user
cart_detail }o--|| cart
cart_detail }o--|| product_version
wishlist }o--|| user
wishlist }o--|| product_version
transaction }o--|| user
transaction_detail }o--|| transaction
transaction_detail }o--|| product_version
product ||--o{ product_version
product_version }o--|| product
product_version }o--|| product_version : previous

@enduml
